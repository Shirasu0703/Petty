<% if @review.errors.any? %>
  <%= @review.errors.count %>件のエラーが発生しました
  <ul>
    <% @review.errors.full_messages.each do |message| %>
      <li><%= message %></li>
    <% end %>
  </ul>
<% end %>

<%= render "layouts/tag_form" %>
<div class="container form-color mt-4 mb-4">
  <div class="card-header bg-warning form-color text-center">
    <h2 class="text-muted my-2"><%= @hospital.name %></h4>
  </div>
  <%= form_with model: @review, url: admin_hospital_review_path(@hospital, @review), method: :patch do |f| %>

  <hr>
  <div class="md-3 mb-3">
    <h4><%= f.label :cleanliness_comment, "清潔さ" %></h4>
    <div id="review_cleanliness_rating_<%= @review.id %>"></div>
    <%= f.text_field :cleanliness_comment, class: "form-control border border-secondary" %>
  </div>

  <div class="md-3 mb-3">
    <h4><%= f.label :doctor_comment, "先生の対応" %></h4>
    <div id="review_doctor_rating_<%= @review.id %>"></div>
    <%= f.text_field :doctor_comment, class: "form-control border border-secondary" %>
  </div>

  <div class="md-3 mb-3">
    <h4><%= f.label :staff_comment, "スタッフの対応" %></h4>
    <div id= "review_staff_rating_<%= @review.id %>"></div>
    <%= f.text_field :staff_comment, class: "form-control border border-secondary" %>
  </div>

  <div class="md-3 mb-3">
    <h4><%= f.label :price_comment, "料金" %></h4>
    <div id= "review_price_rating_<%= @review.id %>"></div>
    <%= f.text_field :price_comment, class: "form-control border border-secondary" %>
  </div>

  <div class="md-3 mb-3">
    <h4><%= f.label :waiting_comment, "待ち時間" %></h4>
    <div id= "review_waiting_rating_<%= @review.id %>"></div>
    <%= f.text_field :waiting_comment, class: "form-control border border-secondary" %>
  </div>

  <div class="md-3 mb-3">
    <h4><%= f.label :title, "レビュータイトル" %></h4>
    <%= f.text_field :title, class: "form-control border border-secondary" %>
  </div>

  <div class="md-3 mb-3">
    <h4><%= f.label :body, "総合評価" %><//h4>
    <%= render 'layouts/rating_form', object: @review, type: :rating, read_only: true, score: @review.rating %>
    <%= f.text_area :body, row: 5, class: "form-control border border-secondary" %>
  </div>

  <div class="md-3 mb-3">
    <h4><%= f.label :animal_comment, "動物目線でひとこと！(任意)" %></h4>
    <%= f.text_field :animal_comment, class: "form-control border border-secondary" %>
  </div>

  <div class="mb-3 mb-3">
    <strong>現在のタグ</strong>
    <div class="d-flex flex-wrap mt-2">
      <% @review.tags.each do |tag| %>
        <div class="position-relative mr-2 mb-2">
          <span class="badge text-primary border p-2 pr-4"><%= tag.tag %></span>
          <%= link_to "&times;".html_safe, remove_tag_admin_hospital_review_path(@review.hospital, @review, tag_id: tag.id),
          method: :delete, data: { confirm: "「#{tag.tag}」を削除しますか？" },
          class: "btn btn-sm btn-danger position-absolute tag-style" %>
        </div>
      <% end %>
    </div>
  </div>
  <div class="mb-3 mb-3 mb-3">
      <p>タグを選択</p>
    <% @tags.each do |tag| %>
      <%= check_box_tag "review[tag_ids][]", tag.id, @review.tags.include?(tag) %>
      <%= tag.tag %>
    <% end %>
    <div class="mt-3 mb-3">
      <h4>新しいタグを入力（カンマ区切りで複数可）</h4>
      <%= text_field_tag "review[new_tag_names]", nil, placeholder: "例）夜間対応, 駐車場あり, 先生が優しい", class: "form-control" %>
    </div>
  </div>

  <div class="text-center my-3 mb-3">
    <%= f.submit "更新", class: "btn btn-warning w-25" %>
    <%= link_to "削除", admin_hospital_review_path(@hospital, @review), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger w-25" %>
  </div>
  <% end %>

  <div class="text-center">
    <%= link_to "詳細に戻る", admin_hospital_review_path(@hospital, @review), class: "btn btn-link-color mb-3 w-25" %> 
    <%= link_to "一覧に戻る", admin_hospitals_path, class: "btn btn-link-color mb-3 w-25" %>
  </div>
</div>

<script>
    var elem = document.getElementById("review_cleanliness_rating_<%= @review.id %>");
    var opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        readOnly: true,
        score: <%= @review.cleanliness_rating %>
    };
    if (elem) elem.innerHTML = "";
    raty(elem,opt);
</script>

<script>
    var elem = document.getElementById("review_doctor_rating_<%= @review.id %>");
    var opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        readOnly: true,
        score: <%= @review.doctor_rating %>
    };
    if (elem) elem.innerHTML = "";
    raty(elem,opt);
</script>

<script>
    var elem = document.getElementById("review_staff_rating_<%= @review.id %>");
    var opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        readOnly: true,
        score: <%= @review.staff_rating %>
    };
    if (elem) elem.innerHTML = "";
    raty(elem,opt);
</script>

<script>
    var elem = document.getElementById("review_price_rating_<%= @review.id %>");
    var opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        readOnly: true,
        score: <%= @review.price_rating %>
    };
    if (elem) elem.innerHTML = "";
    raty(elem,opt);
</script>

<script>
    var elem = document.getElementById("review_waiting_rating_<%= @review.id %>");
    var opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        readOnly: true,
        score: <%= @review.waiting_rating %>
    };
    if (elem) elem.innerHTML = "";
    raty(elem,opt);
</script>

<script>
    var elem = document.getElementById("review_rating_<%= @review.id %>");
    var opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        readOnly: true,
        score: <%= @review.rating %>
    };
    if (elem) elem.innerHTML = "";
    raty(elem,opt);
</script>

